<template>
  <div class="">
    <alert-box />
    <alert-confirmation />
    <div class="custom-container">
      <div class="body-flex">
        <div class="content-body">
          <div class="w-form">
            <form
              id="email-form-2"
              name="email-form-2"
              data-name="Email Form 2"
              method="get"
              class="transaction-table"
              data-wf-page-id="64b6be9c94ade9f930694692"
              data-wf-element-id="417005ac-ddc3-96b2-6b33-6d23b4686e04"
            >
              <div class="table-head admin pro">
                <div class="table-filter foot">
                  <div class="tb-filter-head">
                    <div>Select Product</div>
                    <img
                      src="https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b81c16b31d7eadba21fa56_down.svg"
                      loading="lazy"
                      alt=""
                      class="filter-icon left"
                    />
                  </div>
                  <ul role="list" class="tb-filter-list">
                    <li class="tb-list"><div>Orders</div></li>
                    <li class="tb-list"><div>Sales</div></li>
                    <li class="tb-list"><div>Purchases</div></li>
                    <li class="tb-list"><div>Expenses</div></li>
                  </ul>
                </div>
                <div class="sort-range pro">
                  <div class="sort-wrapper">
                    <div>Name</div>
                    <img
                      src="https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b751d192eeacec8dbc3538_sort.svg"
                      loading="lazy"
                      alt=""
                      class="filter-icon"
                    />
                  </div>
                  <div class="sort-wrapper">
                    <div>Amount</div>
                    <img
                      src="https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b751d192eeacec8dbc3538_sort.svg"
                      loading="lazy"
                      alt=""
                      class="filter-icon"
                    />
                  </div>
                </div>
                <div class="newsletter-wrap pro">
                  <input
                    type="text"
                    class="newsletter-input search w-input"
                    maxlength="256"
                    name="name"
                    data-name="name"
                    placeholder="Search Product"
                    id="name-4"
                  /><img
                    src="https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b75aa41127b73bc77763cb_search-line-icon%201.svg"
                    loading="lazy"
                    alt=""
                    class="newsletter-img"
                  />
                </div>
              </div>
              <div class="table">
                <div class="table-head-row">
                  <div class="tb-sn"><div>S/N</div></div>
                  <div class="tb-image"><div>Image</div></div>
                  <div class="c30 name"><div>Product</div></div>
                  <div class="c20 pro"><div>Price</div></div>
                  <div class="c20 times"><div>Action</div></div>
                </div>
                <div class="table-head-row body">
                  <div class="tb-sn pro">
                    <div class="inner-label">S/N:</div>
                    <div>1</div>
                    <div class="check-box"><div class="check"></div></div>
                  </div>
                  <div class="tb-image pro">
                    <div class="inner-label">Image:</div>
                    <img
                      src="https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo.png"
                      loading="lazy"
                      sizes="(max-width: 479px) 44vw, (max-width: 767px) 19vw, (max-width: 991px) 14vw, (max-width: 1279px) 10vw, 110px"
                      srcset="
                        https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo-p-500.png 500w,
                        https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo-p-800.png 800w,
                        https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo.png       953w
                      "
                      alt=""
                      class="item-img"
                    />
                  </div>
                  <div class="c30 name pro">
                    <div class="inner-label">Product:</div>
                    <div>Gino Tomato</div>
                  </div>
                  <div class="c20 pro">
                    <div class="inner-label">Price:</div>
                    <div>N45,000</div>
                  </div>
                  <div class="c20 times">
                    <div class="inner-label">Position:</div>
                    <div class="action-holder tb">
                      <div class="action-btn"><div>-</div></div>
                      <div>0</div>
                      <div class="action-btn"><div>+</div></div>
                    </div>
                  </div>
                </div>
                <div class="table-head-row body even">
                  <div class="tb-sn pro">
                    <div class="inner-label">S/N:</div>
                    <div>2</div>
                    <div class="check-box"><div class="check"></div></div>
                  </div>
                  <div class="tb-image pro">
                    <div class="inner-label">Image:</div>
                    <img
                      src="https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo.png"
                      loading="lazy"
                      sizes="(max-width: 479px) 44vw, (max-width: 767px) 19vw, (max-width: 991px) 14vw, (max-width: 1279px) 10vw, 110px"
                      srcset="
                        https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo-p-500.png 500w,
                        https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo-p-800.png 800w,
                        https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo.png       953w
                      "
                      alt=""
                      class="item-img"
                    />
                  </div>
                  <div class="c30 name pro">
                    <div class="inner-label">Product:</div>
                    <div>Gino Tomato</div>
                  </div>
                  <div class="c20 pro">
                    <div class="inner-label">Price:</div>
                    <div>N45,000</div>
                  </div>
                  <div class="c20 times">
                    <div class="inner-label">Position:</div>
                    <div class="action-holder tb">
                      <div class="action-btn"><div>-</div></div>
                      <div>0</div>
                      <div class="action-btn"><div>+</div></div>
                    </div>
                  </div>
                </div>
                <div class="table-head-row body">
                  <div class="tb-sn pro">
                    <div class="inner-label">S/N:</div>
                    <div>3</div>
                    <div class="check-box"><div class="check"></div></div>
                  </div>
                  <div class="tb-image pro">
                    <div class="inner-label">Image:</div>
                    <img
                      src="https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo.png"
                      loading="lazy"
                      sizes="(max-width: 479px) 44vw, (max-width: 767px) 19vw, (max-width: 991px) 14vw, (max-width: 1279px) 10vw, 110px"
                      srcset="
                        https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo-p-500.png 500w,
                        https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo-p-800.png 800w,
                        https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b79b7b42421ae3cbdb6ff8_ceo.png       953w
                      "
                      alt=""
                      class="item-img"
                    />
                  </div>
                  <div class="c30 name pro">
                    <div class="inner-label">Product:</div>
                    <div>Gino Tomato</div>
                  </div>
                  <div class="c20 pro">
                    <div class="inner-label">Price:</div>
                    <div>N45,000</div>
                  </div>
                  <div class="c20 times">
                    <div class="inner-label">Position:</div>
                    <div class="action-holder tb">
                      <div class="action-btn"><div>-</div></div>
                      <div>0</div>
                      <div class="action-btn"><div>+</div></div>
                    </div>
                  </div>
                </div>
                <div class="pagination table">
                  <div class="page-result">
                    <h3 class="page-result-txt">Results: 20, Page 1 of 5</h3>
                  </div>
                  <ul role="list" class="pagination-list">
                    <li class="page">
                      <img
                        src="https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b72debe03037906a74116a_thin-chevron-arrow-left-icon%201.svg"
                        loading="lazy"
                        alt=""
                        class="page-icon"
                      />
                    </li>
                    <li class="page"><div>1</div></li>
                    <li class="page active"><div>2</div></li>
                    <li class="page"><div>3</div></li>
                    <li class="page">
                      <img
                        src="https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b72deb58cf5ff7bacff87c_thin-chevron-arrow-left-icon%202.svg"
                        loading="lazy"
                        alt=""
                        class="page-icon"
                      />
                    </li>
                  </ul>
                </div>
              </div>
              <div class="table-head admin pro">
                <div class="tb-filter-head"><div>Anonimous</div></div>
                <div class="newsletter-wrap pro">
                  <input
                    type="text"
                    class="newsletter-input search w-input"
                    maxlength="256"
                    name="name"
                    data-name="name"
                    placeholder="Enter Username"
                    id="name-3"
                  /><img
                    src="https://uploads-ssl.webflow.com/64b6be9c94ade9f93069468e/64b75aa41127b73bc77763cb_search-line-icon%201.svg"
                    loading="lazy"
                    alt=""
                    class="newsletter-img"
                  />
                </div>
              </div>
            </form>
            <div class="w-form-done">
              <div>Thank you! Your submission has been received!</div>
            </div>
            <div class="w-form-fail">
              <div>Oops! Something went wrong while submitting the form.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <footer-component />
  </div>
</template>

<script>
import AlertBox from "../../components/AlertBox.vue";
import AlertConfirmation from "../../components/AlertConfirmation.vue";
import CompanyAds from "../../components/CompanyAds.vue";
import FooterComponent from "../../components/FooterComponent.vue";
import HorizontalNav from "../../components/HorizontalNav.vue";
import MobileBottomNav from "../../components/MobileBottomNav.vue";
import VerticalNav from "../../components/VerticalNav.vue";
export default {
  components: {
    AlertBox,
    AlertConfirmation,
    VerticalNav,
    CompanyAds,
    HorizontalNav,
    FooterComponent,
    MobileBottomNav,
  },
  data() {
    return {
      limit: 10,
      currentPage: 1,

      note: "",

      users: [],
      selectedUser: "Anonimous",
      showList: false,

      showOverlay: false,
      overlayMsg: "",

      showAlert: false,
      alertMsg: "",
      alertError: false,
    };
  },
  methods: {
    formatNumber(number) {
      if (!number) {
        return "0.00";
      }
      const options = { style: "decimal", maximumFractionDigits: 0 };
      return number.toLocaleString("en-US", options);
    },

    selectUser(user) {
      this.selectedUser = user.username;
      this.showList = false;
    },

    clearCart() {
      this.$store.commit("CLEAR_CART");
    },

    removeFromCart(data) {
      this.$store.commit("REMOVE_FROM_CART", data);
    },

    showAlertSuccess(msg, status) {
      this.alertMsg = msg;
      this.showAlert = true;
      this.alertError = status;
      setTimeout(() => {
        this.showAlert = false;
        this.alertMsg = "";
      }, 15000);
    },

    closeOverlay() {
      this.overlayMsg = "";
      this.showOverlay = false;

      const description = [];
      this.cartProducts.forEach((el) => {
        const salesUnit = {
          quantity: "",
          name: "",
          price: "",
        };
        (salesUnit.quantity = el.quantity),
          (salesUnit.name = el.productName),
          (salesUnit.price = el.productSellingPrice);

        description.push(salesUnit);
      });

      const form = {
        totalAmount: this.properties.totalAmount,
        description: description,
        time: new Date().getTime(),
        customer: `${this.selectedUser}`,
        seller: this.user.username,
        categories: this.properties.categories,
        totalPurchases: this.properties.totalQuantity,
        transactionType: "Sell",
        note: this.note,
        status: true,
      };

      this.processOrder(form);
    },

    checkOut() {
      if (this.cartProducts.length == 0) {
        return;
      }
      this.showOverlay = true;
      this.overlayMsg = "Are you sure you to proceed ordering the items?";
    },

    async processOrder(form) {
      try {
        const result = await this.$axios.post(`/transactions`, form);
        this.clearCart();
        this.showAlertSuccess(
          "Your order was successful, you will be contacted soon for delivery",
          false
        );
      } catch (err) {
        this.showCart = false;
        this.showAlertSuccess(err.response.data.message, true);
      }
    },

    async fetchUsers(e) {
      const data = {
        keyWord: e.target.value,
        limit: this.limit,
        page: this.currentPage,
      };
      this.$socket.emit("fetchUsers", data);
    },
  },

  mounted() {
    this.$socket.on("fetchedUsers", (data, cb) => {
      this.users = data;
      if (data.length > 0) {
        this.showList = true;
      }
    });
  },

  computed: {
    cartProducts() {
      return this.$store.state.products;
    },
    properties() {
      return this.$store.state.purchaseProperties;
    },
    user() {
      return this.$store.state.auth.user;
    },
  },
};
</script>

<style></style>
